# frozen_string_literal: true

table = Hash.new([])
lines = DATA.read.lines
width = lines[0].chomp.length
height = lines.length

lines.each_with_index.map { [_1.chomp.chars.each_with_index.to_a, _2] }.each do |row, y|
  row.each do |char, x|
    table[char] += [Complex(x, y)] unless char == '.'
  end
end

antinodes = {}

table.each_value do |positions|
  positions.combination(2).each do |a, b|
    antinodes[2 * a - b] = true
    antinodes[2 * b - a] = true
  end
end

antinodes_within_bounds = antinodes.keys.count do |n|
  n.real >= 0 && n.real < width && n.imag >= 0 && n.imag < height
end

p antinodes_within_bounds # 423

__END__
.....................U.........w..................
l.................................................
...........o.a................U...w...............
............................................W.....
..........T....................s.............7....
.............................................W....
.........T..............4....n.d.H.........5......
......T.....oj...U.....n...w......H...........z...
.G..x..........................E.....V..H.........
.........a....................d....s.......7w.....
...j....r.............o.............V.......d...W.
.......r..J.Goa.U...............n................z
.........Jj.........M..........Pv.................
...J...........t..3..M..............sLV...........
...................t................n.............
....r...........X...........M........v............
...x....t......I......a.PM...............W........
...........1.Bj....I........vO.h.dL...............
.........6....Rr......B...X........h..5v.L..z.....
......1G...........x.....3B.......5...............
.................B....0..........4..E.............
.....................X.....5..h....P....f.....D...
.......1........J.....eK..........................
..................I....R....K...........k.........
......G..................O........................
...........H...9...............K8.P.4..k..E.......
............1....3.............8.F.............f..
.........................4........................
.l...........X............9.......................
....N.................R...t.e.....................
...g............3..R.........e....h.........f.....
...........................e......i...............
................2...I.7..9..O.....s.........k.....
....................6...9E.............F..O.......
........................KN........................
.......g......................Z.........F..f...Y..
...........................A....i.................
...........6g...b........8.......y.....S..........
..l.....6.....m...............8...................
....u..m...b...............p...A..................
..............b.p........................k........
....m......2...........Z..y....i..................
........g2.....b.........i....D..ZF...............
......2.0...........p............N..........A.....
...m.............S...y........A...Z...N...........
..S..l..........................................Y.
........S....0u.................y......DY.........
...........0.........................D............
.................u...................p...Y........
.......u..........................................
